/*!
  * history-navigation-vue v0.4.0
  * (c) 2021 hezedu
  * @license MIT
  */
 !function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.historyNavigationVue=e():t.historyNavigationVue=e()}(window,(function(){return function(t){var e={};function a(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=4)}([function(t,e,a){},function(t,e){t.exports=function(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,a){},function(t,e,a){"use strict";a(0)},function(t,e,a){"use strict";a.r(e),a.d(e,"plugin",(function(){return j})),a.d(e,"version",(function(){return O}));a(2);function n(t,e,a,n,i,s,r,o){var h,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=a,c._compiled=!0),n&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),r?(h=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},c._ssrRegister=h):i&&(h=o?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),h)if(c.functional){c._injectStyles=h;var l=c.render;c.render=function(t,e){return h.call(e),l(t,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,h):[h]}return{exports:t,options:c}}var i,s,r,o=n({name:"HistoryNavigationPage",provide:function(){return{$page:this}},props:{path:{type:String},transitionName:{type:String,default:"h-nav-page"},title:String,isTab:{type:Boolean,required:!0},tabIndex:Number,stateKey:Number,route:{type:Object,required:!0},isActive:{type:Boolean,required:!0},isFirstLoad:{type:Boolean,required:!0}},data:function(){return{isLoad:this.isFirstLoad}},watch:{isActive:function(){this._handleShowHide()}},methods:{_handleShowHide:function(){this.isActive?this.$emit("_h_nav_page_show"):this.$emit("_h_nav_page_hide")}},mounted:function(){var t=this;this.isLoad?this.$emit("_h_nav_page_show"):setTimeout((function(){t.$options._tmp_is_before_destroy||(t.isLoad=!0,t.$nextTick((function(){t.$emit("_h_nav_page_show")})))}))},beforeDestroy:function(){this.isLoad&&(this.$options._tmp_is_before_destroy=!0,this.isActive&&this.$emit("_h_nav_page_hide"),this.isLoad=!1)}},(function(){var t=this.$createElement,e=this._self._c||t;return e("transition",{attrs:{name:this.transitionName,appear:!0}},[e("div",{directives:[{name:"show",rawName:"v-show",value:this.isActive,expression:"isActive"}],class:this.transitionName},[this._t("default")],2)])}),[],!1,null,null,null).exports,h={props:{list:{type:Array,required:!0},currentIndex:{type:Number,required:!0}},name:"HistoryNavigationTabBar"},c=(a(3),n(h,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"h-nav-tabbar"},t._l(t.list,(function(e,n){return a("Navigator",{key:e.pagePath,staticClass:"h-nav-tab",attrs:{isActive:t.currentIndex===n,url:e.pagePath,type:"switchTab"}},[e.icon?a("div",{staticClass:"h-nav-tab-icon",class:e.icon}):t._e(),t._v(" "),a("div",{staticClass:"h-nav-tab-text"},[t._v(t._s(e.text))])])})),1)}),[],!1,null,null,null)),l=n({name:"HistoryNavigationTabBarController",components:{Page:o,TabBar:c.exports},props:{currTabPage:{type:Object,required:!0},isActive:{type:Boolean,required:!0},isFirstLoad:{type:Boolean,required:!0},traClassName:{type:String}},data:function(){return{tabStackMap:this.$navigator._h.tabStackMap,tabList:this.$navigator._h.tabList,globalPageStyle:this.$navigator._h._global.pageStyle,tabBehavior:"_inherit",tabBehaviorDistance:0}},watch:{"currTabPage.tabIndex":function(t,e){var a=t-e,n=a>0?"increase":"reduce";this.tabBehaviorDistance=a,this.tabBehavior=n},isActive:function(){this.tabBehavior="_inherit"}},created:function(){}},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"h-nav-page",appear:!0}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.isActive,expression:"isActive"}],staticClass:"h-nav-tabs-ctrler h-nav-tabs-wrap"},[a("transition-group",{staticClass:"h-nav-tab-pages-wrap",class:"h-nav-tab-behavior-"+t.tabBehavior,style:{"--h-nav-tab-distance":t.tabBehaviorDistance},attrs:{tag:"div","enter-class":"","leave-class":"","enter-to-class":"","leave-to-class":"","enter-active-class":"h-nav-tab_page_load","leave-active-class":"h-nav-tab_page_unload"}},t._l(t.tabStackMap,(function(e){return a("div",{key:e.tabIndex,staticClass:"h-nav-tab-page-handle",class:t.traClassName,style:e.isClean?"transition: none!important; animation: none!important;":""},[a("Page",{class:e.className,style:[t.globalPageStyle,e.style,{zIndex:e.tabIndex}],attrs:{transitionName:"h-nav-tab-page",path:e.path,title:e.title,isTab:e.isTab,tabIndex:e.tabIndex,stateKey:e.stateKey,route:e.route,isActive:t.isActive&&t.currTabPage.tabIndex===e.tabIndex,isFirstLoad:t.isFirstLoad}},[a(e.cmptKey,{tag:"component"})],1)],1)})),0),t._v(" "),a("TabBar",{style:{zIndex:t.tabList.length},attrs:{list:t.tabList,currentIndex:t.currTabPage.tabIndex}})],1)])}),[],!1,null,null,null),u=n({components:{Page:o,TabCtrler:l.exports},name:"HistoryNavigationController",props:{entryPagePath:{type:String}},data:function(){return{isFirstLoad:!0,stackMap:this.$navigator._h.stackMap,behavior:this.$navigator._h.behavior,currentPage:this.$navigator._h.currentPage,globalPageStyle:this.$navigator._h._global.pageStyle,transition:this.$navigator._h._tra}},created:function(){var t=this;this.$navigator._h._load(this.entryPagePath),this.$nextTick((function(){t.isFirstLoad=!1}))},destroyed:function(){this.$navigator._h.destory()}},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition-group",{staticClass:"h-nav-ctrler",class:"h-nav-behavior-"+t.behavior.type,style:{"--h-nav-distance":t.behavior.distance},attrs:{tag:"div","enter-class":"","leave-class":"","enter-to-class":"","leave-to-class":"","enter-active-class":"h-nav--page_load","leave-active-class":"h-nav--page_unload"}},t._l(t.stackMap,(function(e){return a("div",{key:e.stackId,staticClass:"h-nav-page-handle",class:t.transition.className,style:e.isClean?"transition: none!important; animation: none!important;":""},[e.isTab?a("TabCtrler",{key:e.stackId,style:[{zIndex:e.stateKey}],attrs:{traClassName:t.transition.className,currTabPage:e,isActive:e.stackId===t.currentPage.stackId,isFirstLoad:t.isFirstLoad}}):a("Page",{key:e.stackId,class:e.className,style:[t.globalPageStyle,e.style,{zIndex:e.stateKey}],attrs:{transitionName:"h-nav-page",path:e.path,title:e.title,isTab:e.isTab,tabIndex:e.tabIndex,stateKey:e.stateKey,route:e.route,isActive:e.stackId===t.currentPage.stackId,isFirstLoad:t.isFirstLoad}},[a(e.cmptKey,{tag:"component"})],1)],1)})),0)}),[],!1,null,null,null).exports,p=n({},(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{"padding-top":"8%","text-align":"center"}},[e("h1",[this._v("History Navigation Vue")]),this._v(" "),e("h2",[this._v("Page Not Found")]),this._v(" "),e("p",[this._v('"'+this._s(this.$page.route.fullPath)+'"')])])}),[],!1,null,null,null).exports,_=Object.assign(Object.create(null),{push:!0,replace:!0,relaunch:!0,switchTab:!0}),d=n({name:"HistoryNavigator",props:{url:{type:String},type:{type:String,default:"push"},steps:{type:Number,default:1},transition:{type:String},isActive:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},event:{type:String}},computed:{href:function(){return this.url?this.$navigator._h.URL.toLocationUrl(this.url):void 0}},methods:{handleEvent:function(t){if(t.preventDefault(),!this.isActive&&!this.disabled)switch(this.type){case"back":this.$navigator._h.back(this.steps,this.transition);break;default:_[this.type]?this.$navigator._h[this.type]({url:this.url,transition:this.transition}):console.error("history-navigation-vue navigator not support type: "+this.type)}}},mounted:function(){var t=this.event||this.$navigator._h._global.navigatorTriggerEvent;this.$el.addEventListener(t,this.handleEvent)}},(function(){var t=this.$createElement;return(this._self._c||t)("a",{class:{"h-nav-active":this.isActive,"h-nav-disabled":this.disabled},attrs:{href:this.href}},[this._t("default")],2)}),[],!1,null,null,null).exports,v=a(1),f=a.n(v);function b(t){var e=t.isHashMode,a=void 0===e||e,n=t.base,i=void 0===n?"":n;this.isHashMode=a,this._location=r,a?this.hashBase=this._location.pathname+this._location.search+"#":this.base=i}function g(t){var e,a,n=t.indexOf("?");return-1!==n?(e=t.substr(0,n),a=t.substr(n+1)):(e=t,a=""),{path:e,query:k(a)}}function y(t){var e,a,n;return"string"==typeof t?(e=g(t),a=t):a=P(e=m(t)),n=I(e.path),Object.assign({fullPath:a,trimedPath:n},e)}function m(t){if(-1===t.path.indexOf("?"))return t;var e=g(t.path);return Object.assign(e.query,t.query),e}function P(t){var e=function(t){if(!t)return"";var e=[];return Object.keys(t).forEach((function(a){e.push(a+"="+encodeURIComponent(t[a]))})),e.join("&")}(t.query);return e&&(e="?"+e),t.path+e}function k(t){var e=Object.create(null);if(!t||"string"==typeof t&&0===t.length)return e;for(var a,n=t.split("&"),i=0,s=n.length;i<s;i++)e[(a=(a=n[i]).split("="))[0]]=decodeURIComponent(a[1]);return e}function I(t){var e=t.split("/");return(e=e.filter((function(t){return""!==t}))).join("/")}"undefined"!=typeof window?(i=window,s=window.history,r=window.location,window.requestAnimationFrame||setTimeout):setTimeout,b.prototype.getHashUrlByLocation=function(){var t=this._location.hash;return t.length>0&&(t=t.substr(1)),t},b.prototype.getUrlByLocation=function(){if(this.isHashMode)return this.getHashUrlByLocation();var t=this._location.pathname;return 0===t.indexOf(this.base)&&(t=t.substr(this.base.length)),t+this._location.search},b.prototype.getRouteByLocation=function(){return g(this.getUrlByLocation())},b.prototype.toLocationUrl=function(t){return this.isHashMode?this.hashBase+t:this.base+t};var T=b;function w(){var t=s.state;return t&&"number"==typeof t._h_n_key?t._h_n_key:1}var x=w();function S(t){x=t}function M(t,e,a,n){var i=e[a];t[a]=void 0===i?n:i}function $(t){throw new Error("history-navigation-vue: ".concat(t))}var C=!1;function B(t){var e=this;C&&$("Only one instance can be generated."),C=!0,this._global=t.global,this._window=i,this._history=s,this._location=r,this._tra={className:this._global.transition},this._Vue=t.Vue,this._history&&this._history.pushState||$("required history.pushState API"),this.pageMap=t.pageMap,this.notFoundPage=t.notFoundPage,t.tabBar&&(this.tabMap=t.tabBar.map,this.tabList=t.tabBar.list,this.tabStackMap=Object.create(null)),this.stackMap=Object.create(null),this._whenPopInfo=null,this._whenPopTra=null,this._stackItemId=1,this.tabCtrlerStackId=1,this.onRouted=t.onRouted,this.URL=new T({isHashMode:t.urlIsHashMode,base:t.urlBase}),this._popstateHandle=function(){e.handlePop()},this.behavior={type:"",distance:0,isPop:!1},this.currentPage={path:null,title:null,className:void 0,isTab:!1,tabIndex:null,cmptKey:null,stackId:null,stateKey:null,isClean:!1,route:{}}}B.prototype._onRouted=function(){if(this.onRouted){var t=this.currentPage;this.onRouted({title:t.title,routeFullPath:t.route.fullPath})}},B.prototype._genStackItemId=function(){return this._stackItemId=this._stackItemId+1,"stack_"+this._stackItemId},B.prototype._isTabRoute=function(t){return!!this.tabMap&&!!this.tabMap[t]},B.prototype._forMatInputArg=function(t){var e,a;return"string"==typeof t?e=y(t):(e=y({path:t.url,query:t.query}),a=t.transition),{fullParse:e,tra:a}},B.prototype._load=function(t){this._window.addEventListener("popstate",this._popstateHandle);var e=y(void 0===t?this.URL.getUrlByLocation():t);1!==w()&&this._isTabRoute(e.trimedPath)?this._backToStartAndReplace(e,"loaded"):this._replace(e,"loaded")},B.prototype._setTra=function(t){this._tra.className=t||this._global.transition},B.prototype.push=function(t){var e=this._forMatInputArg(t),a=e.fullParse,n=e.tra;this._isTabRoute(a.trimedPath)?console.error("Cannot push the tab url, please use switchTab"):(this._setTra(n),this._push(a,n))},B.prototype.replace=function(t){var e=this._forMatInputArg(t),a=e.fullParse,n=e.tra;this._isTabRoute(a.trimedPath)?console.error("Cannot replace the tab url, please use switchTab"):(this._setTra(n),this._replace(a))},B.prototype.switchTab=function(t){var e=this._forMatInputArg(t),a=e.fullParse,n=e.tra;this._isTabRoute(a.trimedPath)?this._backToStartAndReplace(a,"switchtab",n):console.error(t+" is not tab url")},B.prototype.back=function(t,e){var a=w();return 1===a?(console.error("Currnt page is first, Cannot back."),-1):"number"==typeof t&&t>0&&a-t<1?-1:(this._whenPopTra=e,t?this._history.go(-t):this._history.back(),0)},B.prototype.relaunch=function(t){var e=this._forMatInputArg(t),a=e.fullParse,n=e.tra;this.tabCtrlerStackId=this.tabCtrlerStackId+1,this._backToStartAndReplace(a,"relaunch",n)},B.prototype._setMapItem=function(t,e){var a=this.pageMap[e.trimedPath]||this.notFoundPage,n={path:a.path,title:a.title,tabIndex:a.tabIndex,route:e,cmptKey:a.cmptKey,isTab:a.isTab,stateKey:t,className:a.className,style:a.style,isClean:!1};n.isTab?(n.stackId="tab_stack_"+this.tabCtrlerStackId,this._Vue.set(this.tabStackMap,a.tabIndex,n)):n.stackId=this._genStackItemId(),this._Vue.set(this.stackMap,t,n),Object.assign(this.currentPage,n)},B.prototype._getBackTra=function(){var t=this._history;if(t.state)return t.state.h_nav_b_tra},B.prototype._push=function(t,e){if(e!==this._getBackTra()){var a=Object.assign({},this._history.state);e?a.h_nav_b_tra=e:delete a.h_nav_b_tra,this._history.replaceState(a,"")}var n=w()+1;this._history.pushState(f()({},"_h_n_key",n),"",this.URL.toLocationUrl(t.fullPath)),S(n);Object.assign(this.behavior,{type:"push",distance:1,isPop:!1}),this._setMapItem(n,t),this._onRouted()},B.prototype._replace=function(t,e,a){var n=this,i=void 0===a?0:a,s={type:e||"replace",distance:i,isPop:!1};Object.assign(this.behavior,s);var r=w();("switchtab"!==this.behavior.type||i)&&(this.currentPage.stackId="unactive_"+this.currentPage.stackId);var o=this.URL.toLocationUrl(t.fullPath),h=this._history.state;h&&h._h_n_key||((h=Object.assign({},history.state))._h_n_key=r),this._history.replaceState(h,"",o),this._Vue.nextTick((function(){if("relaunch"===s.type){n._setAllCleaned();var e=r-i;n.stackMap[e].isClean=!1,n._Vue.nextTick((function(){n._clearAll(),n._setMapItem(r,t)}))}else n._clearAfter(),n._setMapItem(r,t),n._onRouted()}))},B.prototype._setMapCleaned=function(t){for(var e in t)t[e].isClean=!0},B.prototype._setAllCleaned=function(){this.tabStackMap&&this._setMapCleaned(this.tabStackMap),this._setMapCleaned(this.stackMap)},B.prototype._backToStartAndReplace=function(t,e,a){var n=w();n>1?(this._whenPopInfo={fullParse:t,behavior:e},this.back(n-1,a)):(this._setTra(a),this._replace(t,e))},B.prototype._clearAfter=function(){var t,e,a=this,n=w(),i=this.stackMap,s=[];for(t in i)(e=i[t]).stateKey>n&&(e.isClean=!0,s.push(e));var r=s.length;if(r){var o=s.pop();o.isClean=!1,this._Vue.delete(i,o.stateKey),(r=s.length)&&this._Vue.nextTick((function(){for(t=0;t<r;t++)e=s[t],a._Vue.delete(i,e.stateKey)}))}},B.prototype._clearMap=function(t){var e;for(e in t)this._Vue.delete(t,e)},B.prototype._clearAll=function(){this.tabStackMap&&this._clearMap(this.tabStackMap),this._clearMap(this.stackMap)},B.prototype.handlePop=function(){var t=this,e=x,a=w();S(a);var n=this._whenPopInfo,i=a-e,s=i<0?"back":"forward",r=this._whenPopTra;if(r||"back"!==s||-1!==i||(r=this._getBackTra()),this._setTra(r),this._whenPopTra=null,null!==n)return this._replace(n.fullParse,n.behavior,i),void(this._whenPopInfo=null);var o=this.stackMap[a],h={type:s,distance:i,isPop:!0};Object.assign(this.behavior,h),o?Object.assign(this.currentPage,o):this._setMapItem(a,y(this.URL.getUrlByLocation())),"back"===s?this._Vue.nextTick((function(){t._clearAfter(),t._onRouted()})):this._onRouted()},B.prototype.destory=function(){this._window.removeEventListener("popstate",this._popstateHandle),C=!1};var L=B;var A={inject:{$page:{default:null}},created:function(){(this.$options.onShow||this.$options.onHide)&&this.$page&&function(t){var e,a=t.$options;a.__tmp_h_nav_show_hide_has=!0,a.onShow&&(e=a.__tmp_h_nav_page_show_hanlde=function(){a.onShow.call(t)},t.$page.$on("_h_nav_page_show",e));a.onHide&&(e=a.__tmp_h_nav_page_hide_hanlde=function(){a.onHide.call(t)},t.$page.$on("_h_nav_page_hide",e))}(this)},destroyed:function(){this.$options.__tmp_h_nav_show_hide_has&&function(t){var e=t.$options,a=e.__tmp_h_nav_page_show_hanlde;a&&t.$page.$off("_h_nav_page_show",a);(a=e.__tmp_h_nav_page_hide_hanlde)&&t.$page.$off("_h_nav_page_hide",a)}(this)}};var N={title:"Not Found",component:p};var j={install:function(t,e){Array.isArray(e.pages)||$("config.pages is not Array.");var a,n=function(t){for(var e,a,n,i=Object.create(null),s=0,r=t.length;s<r;s++)e=t[s],a=I(e.path),i[a]&&$("pageMap key: ".concat(a," is same as ").concat(e.path)),n=Object.assign({},e),Object.assign(n,{trimedPath:a,isTab:!1,cmptKey:"h-nav-page-"+s}),i[a]=n;return i}(e.pages);e.tabBar&&(a=function(t,e){var a=t.list,n=a.length;n<2&&$("tabBar list length must >= 2");for(var i,s,r=0,o=Object.create(null),h=[];r<n;r++){s=a[r],i=I(s.pagePath);var c=e[i];c&&c.path===s.pagePath||$("tabBar pagePath: ".concat(r," is not found in pages")),o[i]&&$("tabBar pagePath: ".concat(i," is same as ").concat(r)),c.isTab=!0,c.tabIndex=r,o[i]=!0,h.push(Object.assign({},s))}return{map:o,list:h}}(e.tabBar,n));var i,s,r=e.notFoundPage||N;for(i in t.component("h-nav-page-not-found",r.component),r={path:null,title:r.title,cmptKey:"h-nav-page-not-found",isTab:!1,trimedPath:null},n)s=n[i],t.component(s.cmptKey,s.component);t.component("NavigationController",u),t.component("Navigator",d);var o=Object.create(null);M(o,e,"navigatorTriggerEvent","click"),M(o,e,"transition","h-nav-transition"),M(o,e,"pageStyle",void 0);var h,c,l={global:o,Vue:t,pageMap:n,cmptPageSuffix:"h-nav-page-",notFoundPage:r,tabBar:a,onRouted:e.onRouted};M(l,e,"urlBase",""),M(l,e,"urlIsHashMode",!0),t.prototype.$navigator=(h=new L(l),c={_h:h},["push","back","replace","relaunch","switchTab"].forEach((function(t){!function(t,e,a){t[e]=function(){a[e].apply(a,arguments)}}(c,t,h)})),c),t.mixin(A)}},O="0.4.0"}])}));